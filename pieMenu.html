<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
      user-select: none;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .pie-menu {
      width: 600px;
      height: 6600x;
      position: relative;
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .menu-item {
      position: absolute;
      width: 80px;
      height: 80px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      opacity: 0;
      animation: shootFromCenter 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    /* 从中心发射的动画 */
    @keyframes shootFromCenter {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.2);
        top: 50%;
        left: 50%;
      }
      100% {
        opacity: 1;
        transform: translate(var(--tx), var(--ty)) scale(1);
        top: var(--final-top);
        left: var(--final-left);
      }
    }

    /* 三角形布局 - 调整位置 */
    #comfy {
      --final-top: calc(50% - 60px);   /* 上方图标再下移一点 */
      --final-left: 50%;
      --tx: -50%;
      --ty: 0;
      animation-delay: 0s;
    }

    #vue {
      --final-top: calc(50% + 35px);   /* 左下图标稍微下移 */
      --final-left: calc(50% - 50px);  /* 左侧偏移减小 */
      --tx: 0;
      --ty: 0;
      animation-delay: 0.1s;
    }

    #node {
      --final-top: calc(50% + 35px);   /* 右下图标稍微下移 */
      --final-left: calc(50% + 50px);  /* 右侧偏移减小 */
      --tx: 0;
      --ty: 0;
      animation-delay: 0.2s;
    }

    .menu-item::before {
      content: '';
      width: 80px;
      height: 80px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transition: transform 0.2s ease;
    }

    .menu-item:hover::before {
      transform: scale(1.1);
    }

    /* 刷新按钮动画 */
    .refresh-button {
      position: absolute;
      width: 35px;
      height: 35px;
      left: 60%;  /* 水平居中 */
      top: calc(50% + 35px);  /* 略微下移 */
      transform: translate(-50%, -50%) scale(0);
      background: rgba(40, 44, 52, 0.95);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.3s forwards;
    }

    @keyframes popIn {
      0% {
        transform: translate(-50%, -50%) scale(0);
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .refresh-button:hover {
      background: rgba(50, 54, 62, 0.95);
      transform: translate(-50%, -50%) scale(1.1);
    }

    /* 图标样式 */
    #comfy::before {
      content: '';
      width: 100px;
      height: 100px;
      background-image: url('./assets/comfyui.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    #vue::before {
      content: '';
      width: 100px;
      height: 100px;
      background-image: url('./assets/logo1.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    #node::before {
      content: '';
      width: 100px;
      height: 100px;
      background-image: url('./assets/logo2.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    /* 刷新按钮图标 */
    .refresh-button::before {
      content: '';
      width: 24px;
      height: 24px;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23FFFFFF" d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="pie-menu">
    <div class="divider" id="divider1"></div>
    <div class="divider" id="divider2"></div>
    <div class="divider" id="divider3"></div>
    <div class="menu-item" id="comfy"></div>
    <div class="menu-item" id="vue"></div>
    <div class="menu-item" id="node"></div>
    <div class="refresh-button"></div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    document.getElementById('comfy').addEventListener('click', () => {
      // 发送导航消息到主进程
      ipcRenderer.send('navigate', 'comfyui');
      
      // 添加淡出效果
      document.querySelector('.pie-menu').style.opacity = '0';
      setTimeout(() => window.close(), 300);
    });

    document.getElementById('vue').addEventListener('click', () => {
      ipcRenderer.send('navigate', 'https://chat.deepseek.com/sign_in');
      
      document.querySelector('.pie-menu').style.opacity = '0';
      setTimeout(() => window.close(), 300);
    });

    document.getElementById('node').addEventListener('click', () => {
      ipcRenderer.send('navigate', 'http://localhost:3005');
    });

    // 重置动画函数
    function resetAnimations() {
      const menuItems = document.querySelectorAll('.menu-item');
      const refreshButton = document.querySelector('.refresh-button');
      
      // 重置菜单项动画
      menuItems.forEach((item, index) => {
        item.style.animation = 'none';
        item.offsetHeight; // 触发重排
        item.style.animation = `shootFromCenter 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) ${index * 0.1}s forwards`;
      });
      
      // 重置刷新按钮动画
      refreshButton.style.animation = 'none';
      refreshButton.offsetHeight;
      refreshButton.style.animation = 'popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.3s forwards';
    }

    // 监听窗口显示事件
    ipcRenderer.on('window-show', () => {
      resetAnimations();
    });

    // 监听快捷键
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        window.close();
      }
    });

    // 添加点击事件监听器到 body
    document.body.addEventListener('click', (e) => {
      // 如果点击的不是菜单项或刷新按钮（即点击了外部区域）
      if (!e.target.closest('.menu-item') && !e.target.closest('.refresh-button')) {
        document.querySelector('.pie-menu').style.opacity = '0';
        setTimeout(() => window.close(), 300);
      }
    });

    // 点击菜单项后添加淡出效果
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.stopPropagation(); // 阻止事件冒泡到 body
        document.querySelector('.pie-menu').style.opacity = '0';
        setTimeout(() => window.close(), 300);
      });
    });

    // 修改刷新按钮点击事件
    document.querySelector('.refresh-button').addEventListener('click', (e) => {
        e.stopPropagation(); // 阻止事件冒泡
        try {
            // 发送刷新消息
            ipcRenderer.send('refresh-page');
            
            // 添加视觉反馈
            const refreshButton = document.querySelector('.refresh-button');
            refreshButton.style.transform = 'rotate(360deg)';
            refreshButton.style.transition = 'transform 0.3s ease';
            
            // 隐藏菜单
            setTimeout(() => {
                document.querySelector('.pie-menu').style.opacity = '0';
                setTimeout(() => {
                    ipcRenderer.send('hide-pie-menu');
                }, 300);
            }, 100);
        } catch (error) {
            console.error('Error sending refresh command:', error);
        }
    });
  </script>
</body>
</html> 